---
description: REST API è®¾è®¡è§„èŒƒ
globs:
  - "**/controller/**"
  - "**/*Controller.java"
---

# 80 REST API è®¾è®¡è§„èŒƒ

## é€‚ç”¨èŒƒå›´

- é€‚ç”¨äºï¼š`**/controller/**`ã€`**/*Controller.java`ã€Controller ç›¸å…³ä»£ç 
- ä¸é€‚ç”¨äºï¼šOAuth2 æ ‡å‡†ç«¯ç‚¹ï¼ˆç”±æ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼‰

## ç¦æ­¢ï¼ˆMust Notï¼‰

- âŒ Controller ä¸­æ‰‹åŠ¨è¿”å›é”™è¯¯æ ¼å¼ï¼ˆåº”æŠ›å‡ºå¼‚å¸¸ï¼Œç”± GlobalExceptionHandler ç»Ÿä¸€å¤„ç†ï¼‰ã€‚
- âŒ ä½¿ç”¨ `Map.of("success", false, "error", "...")` ç­‰ä¸´æ—¶æ ¼å¼ã€‚
- âŒ è·¯å¾„ä½¿ç”¨åŠ¨è¯ï¼ˆåº”ä½¿ç”¨èµ„æºåè¯ï¼š`/scheduling/task-type` è€Œé `/scheduling/getTaskType`ï¼‰ã€‚
- âŒ æ··ç”¨ä¸åŒçš„å“åº”æ ¼å¼ï¼ˆå¿…é¡»ç»Ÿä¸€ä½¿ç”¨ GlobalResponse æˆ– ErrorResponseï¼‰ã€‚
- âŒ è¿”å›çº¯æ–‡æœ¬é”™è¯¯ä¿¡æ¯ï¼ˆåº”è¿”å›ç»“æ„åŒ–é”™è¯¯å“åº”ï¼‰ã€‚
- âŒ è·¯å¾„ä½¿ç”¨ `/api/` å‰ç¼€ï¼ˆé¡¹ç›®ä¸ä½¿ç”¨æ­¤å‰ç¼€ï¼‰ã€‚

## å¿…é¡»ï¼ˆMustï¼‰

- âœ… RESTful è·¯å¾„ï¼šèµ„æºåè¯ï¼ˆ`/scheduling`ã€`/process`ã€`/user`ï¼‰ï¼ŒHTTP æ–¹æ³•è¡¨ç¤ºæ“ä½œï¼ˆGET/POST/PUT/DELETEï¼‰ã€‚
- âœ… ç»Ÿä¸€å“åº”æ ¼å¼ï¼šæˆåŠŸä½¿ç”¨ `GlobalResponse<T>`ï¼Œå¤±è´¥ä½¿ç”¨ `ErrorResponse`ï¼ˆcode, message, detail, status, path, timestampï¼‰ã€‚
- âœ… HTTP çŠ¶æ€ç ï¼š200ï¼ˆæˆåŠŸï¼‰ã€400ï¼ˆå‚æ•°é”™è¯¯ï¼‰ã€401ï¼ˆæœªæˆæƒï¼‰ã€403ï¼ˆæ— æƒé™ï¼‰ã€404ï¼ˆä¸å­˜åœ¨ï¼‰ã€500ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰ã€‚
- âœ… å‚æ•°å‘½åï¼šè¯·æ±‚/å“åº”å‚æ•°ä½¿ç”¨ camelCaseï¼ˆJava æ ‡å‡†ï¼‰ã€‚
- âœ… å¼‚å¸¸å¤„ç†ï¼šService å±‚æŠ›å‡ºå¼‚å¸¸ï¼ŒController ä¸æ•è·ï¼Œç”± `GlobalExceptionHandler` ç»Ÿä¸€å¤„ç†ã€‚
- âœ… é”™è¯¯ç ï¼šä½¿ç”¨ `ResponseCode` æšä¸¾ï¼Œä¸ç¡¬ç¼–ç é”™è¯¯ç ã€‚

## åº”è¯¥ï¼ˆShouldï¼‰

- âš ï¸ åˆ†é¡µå‚æ•°ï¼šç»Ÿä¸€ä½¿ç”¨ `page`ï¼ˆé¡µç ï¼Œä» 1 å¼€å§‹ï¼‰å’Œ `size`ï¼ˆæ¯é¡µæ•°é‡ï¼‰ï¼Œè¿”å› `Page<T>` æˆ– `PageResponse<T>`ã€‚
- âš ï¸ æŸ¥è¯¢å‚æ•°ï¼šåˆ—è¡¨æŸ¥è¯¢æ”¯æŒ `sort`ï¼ˆæ’åºå­—æ®µï¼‰ã€`order`ï¼ˆasc/descï¼‰ã€`keyword`ï¼ˆå…³é”®è¯æœç´¢ï¼‰ã€‚
- âš ï¸ å“åº”å¤´ï¼šè·¨åŸŸã€ç¼“å­˜æ§åˆ¶ç­‰é€šè¿‡ `ResponseEntity` çš„ `HttpHeaders` è®¾ç½®ã€‚
- âš ï¸ æ–‡æ¡£ï¼šä½¿ç”¨ Swagger/OpenAPI æ³¨è§£ï¼ˆ`@ApiOperation`ã€`@ApiParam`ï¼‰æ ‡æ³¨æ¥å£ã€‚

## å¯ä»¥ï¼ˆMayï¼‰

- ğŸ’¡ æ‰¹é‡æ“ä½œï¼šæ”¯æŒæ‰¹é‡åˆ›å»º/æ›´æ–°/åˆ é™¤ï¼Œè·¯å¾„ `/scheduling/task/batch`ï¼Œè¯·æ±‚ä½“ä¸ºæ•°ç»„ã€‚
- ğŸ’¡ æ¡ä»¶æŸ¥è¯¢ï¼šå¤æ‚æŸ¥è¯¢ä½¿ç”¨ POST `/scheduling/task/query`ï¼Œè¯·æ±‚ä½“åŒ…å«æŸ¥è¯¢æ¡ä»¶ã€‚
- ğŸ’¡ å¯¼å‡ºåŠŸèƒ½ï¼šå¯¼å‡ºæ¥å£ä½¿ç”¨ GET `/export/task`ï¼Œè¿”å›æ–‡ä»¶æµã€‚

## ä¾‹å¤–ä¸è£å†³

- OAuth2 æ ‡å‡†ç«¯ç‚¹ï¼ˆ`/oauth2/authorize`ã€`/oauth2/token`ï¼‰éµå¾ª OAuth2 è§„èŒƒï¼Œä¸å—æœ¬è§„èŒƒçº¦æŸã€‚
- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ï¼šå¯ä½¿ç”¨ `MultipartFile` å’Œ `ResponseEntity<Resource>`ã€‚
- å†²çªæ—¶ï¼šå¹³å°ç‰¹å®šè§„åˆ™ï¼ˆ90+ï¼‰ä¼˜å…ˆäºæœ¬è§„èŒƒã€‚

## ç¤ºä¾‹

### âœ… æ­£ä¾‹

```java
@RestController
@RequestMapping("/scheduling")
public class SchedulingController {
    
    @GetMapping("/task-type/{id}")
    public ResponseEntity<GlobalResponse<TaskTypeDTO>> getTaskType(@PathVariable Long id) {
        TaskTypeDTO taskType = schedulingService.getTaskTypeById(id);
        return ResponseUtil.ok(taskType);
    }
    
    @PostMapping("/task-type")
    public ResponseEntity<GlobalResponse<TaskTypeDTO>> createTaskType(
            @Valid @RequestBody CreateTaskTypeRequest request) {
        TaskTypeDTO taskType = schedulingService.createTaskType(request);
        return ResponseUtil.ok(taskType);
    }
    
    // Service å±‚æŠ›å‡ºå¼‚å¸¸ï¼Œç”± GlobalExceptionHandler å¤„ç†
    @DeleteMapping("/task-type/{id}")
    public ResponseEntity<GlobalResponse<Void>> deleteTaskType(@PathVariable Long id) {
        schedulingService.deleteTaskType(id); // å†…éƒ¨æŠ›å‡º BusinessException
        return ResponseUtil.ok(null);
    }
    
    @GetMapping("/task-type/list")
    public ResponseEntity<GlobalResponse<PageResponse<TaskTypeDTO>>> listTaskTypes(
            @PageableDefault(size = 20, sort = "id", direction = Sort.Direction.DESC) Pageable pageable) {
        PageResponse<TaskTypeDTO> result = schedulingService.listTaskTypes(pageable);
        return ResponseUtil.ok(result);
    }
}
```

### âŒ åä¾‹

```java
// é”™è¯¯ï¼šæ‰‹åŠ¨è¿”å›é”™è¯¯æ ¼å¼ã€è·¯å¾„ä½¿ç”¨åŠ¨è¯ã€ä½¿ç”¨ /api/ å‰ç¼€ã€æ··ç”¨å“åº”æ ¼å¼
@RestController
@RequestMapping("/api/scheduling") // âŒ ä¸åº”ä½¿ç”¨ /api/ å‰ç¼€
public class SchedulingController {
    
    @GetMapping("/getTaskType/{id}") // âŒ è·¯å¾„ä½¿ç”¨åŠ¨è¯
    public Map<String, Object> getTaskType(@PathVariable Long id) {
        TaskType taskType = schedulingService.getTaskTypeById(id);
        if (taskType == null) {
            return Map.of("success", false, "error", "ä»»åŠ¡ç±»å‹ä¸å­˜åœ¨"); // âŒ æ‰‹åŠ¨è¿”å›é”™è¯¯æ ¼å¼
        }
        return Map.of("success", true, "data", taskType); // âŒ æ··ç”¨å“åº”æ ¼å¼
    }
}
```

