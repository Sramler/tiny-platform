---
description: å¼‚å¸¸å¤„ç†è§„èŒƒ
globs:
  - "**/exception/**"
  - "**/*Exception*.java"
  - "**/handler/**"
---

# 75 å¼‚å¸¸å¤„ç†è§„èŒƒ

## é€‚ç”¨èŒƒå›´

- é€‚ç”¨äºï¼š`**/exception/**`ã€`**/*Exception*.java`ã€`**/handler/**`ã€å¼‚å¸¸å¤„ç†ç›¸å…³ä»£ç 

## ç¦æ­¢ï¼ˆMust Notï¼‰

- âŒ Controller å±‚æ•è·ä¸šåŠ¡å¼‚å¸¸å¹¶æ‰‹åŠ¨è¿”å›é”™è¯¯å“åº”ï¼ˆåº”æŠ›å‡ºå¼‚å¸¸ï¼Œç”± GlobalExceptionHandler ç»Ÿä¸€å¤„ç†ï¼‰ã€‚
- âŒ Service å±‚è¿”å› `Map.of("success", false, "error", "...")`ï¼ˆåº”æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚
- âŒ å¼‚å¸¸ä¿¡æ¯ä¸­åŒ…å«æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ã€å¯†é’¥ã€å®Œæ•´ SQLã€å®Œæ•´å †æ ˆï¼‰ã€‚
- âŒ åæ‰å¼‚å¸¸ä¸è®°å½•æ—¥å¿—ï¼ˆå¿…é¡»è®°å½•å¼‚å¸¸æ—¥å¿—ï¼‰ã€‚

## å¿…é¡»ï¼ˆMustï¼‰

- âœ… å¼‚å¸¸åˆ†ç±»ï¼š`BusinessException`ï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰ã€`ValidationException`ï¼ˆå‚æ•°æ ¡éªŒå¼‚å¸¸ï¼‰ã€`SystemException`ï¼ˆç³»ç»Ÿå¼‚å¸¸ï¼‰ã€‚
- âœ… ç»Ÿä¸€å¼‚å¸¸å“åº”ï¼šä½¿ç”¨ `ErrorResponse` æ ¼å¼ï¼ˆcode, message, detail, status, path, timestampï¼‰ã€‚
- âœ… å¼‚å¸¸å¤„ç†å±‚æ¬¡ï¼šController ä¸æ•è·ä¸šåŠ¡å¼‚å¸¸ï¼ŒService æŠ›å‡ºå¼‚å¸¸ï¼Œ`GlobalExceptionHandler` ç»Ÿä¸€å¤„ç†ã€‚
- âœ… å¼‚å¸¸ä¿¡æ¯è„±æ•ï¼šæ—¥å¿—å’Œå“åº”ä¸­ä¸åŒ…å«æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ã€å¯†é’¥ã€å®Œæ•´ SQLï¼‰ã€‚
- âœ… å¼‚å¸¸ç è§„èŒƒï¼šä½¿ç”¨ `ResponseCode` æšä¸¾ï¼Œä¸ç¡¬ç¼–ç é”™è¯¯ç ã€‚

## åº”è¯¥ï¼ˆShouldï¼‰

- âš ï¸ å¼‚å¸¸æ—¥å¿—ï¼šè®°å½•å¼‚å¸¸çº§åˆ«ï¼ˆERROR/WARNï¼‰ã€å¼‚å¸¸ä¿¡æ¯ã€ä¸Šä¸‹æ–‡ï¼ˆç”¨æˆ·IDã€è¯·æ±‚è·¯å¾„ã€å‚æ•°æ‘˜è¦ï¼‰ã€‚
- âš ï¸ å‚æ•°æ ¡éªŒï¼šä½¿ç”¨ `@Valid` å’Œ Bean Validationï¼Œæ ¡éªŒå¤±è´¥æŠ›å‡º `MethodArgumentNotValidException`ã€‚
- âš ï¸ å¼‚å¸¸é“¾ï¼šä¿ç•™åŸå§‹å¼‚å¸¸ï¼ˆ`cause`ï¼‰ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚
- âš ï¸ å¼‚å¸¸è½¬æ¢ï¼šç¬¬ä¸‰æ–¹å¼‚å¸¸ï¼ˆå¦‚æ•°æ®åº“å¼‚å¸¸ï¼‰è½¬æ¢ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼Œé¿å…æ³„æ¼æŠ€æœ¯ç»†èŠ‚ã€‚

## å¯ä»¥ï¼ˆMayï¼‰

- ğŸ’¡ å¼‚å¸¸ç›‘æ§ï¼šé›†æˆå¼‚å¸¸ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Sentryï¼‰ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥å¼‚å¸¸ã€‚
- ğŸ’¡ å¼‚å¸¸é‡è¯•ï¼šå¯é‡è¯•å¼‚å¸¸ï¼ˆå¦‚ç½‘ç»œè¶…æ—¶ï¼‰æ”¯æŒè‡ªåŠ¨é‡è¯•æœºåˆ¶ã€‚

## ä¾‹å¤–ä¸è£å†³

- OAuth2 å¼‚å¸¸ï¼šç”± `OAuth2ExceptionHandler` å¤„ç†ï¼Œéµå¾ª OAuth2 è§„èŒƒã€‚
- æ¡†æ¶å¼‚å¸¸ï¼šSpring Securityã€Spring Data ç­‰æ¡†æ¶å¼‚å¸¸ç”±æ¡†æ¶å¤„ç†ã€‚
- å†²çªæ—¶ï¼šå®‰å…¨è§„èŒƒï¼ˆ40-securityï¼‰ä¼˜å…ˆäºæœ¬è§„èŒƒã€‚

## ç¤ºä¾‹

### âœ… æ­£ä¾‹

```java
// Service å±‚æŠ›å‡ºå¼‚å¸¸
@Service
public class UserService {
    public UserDTO getById(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new BusinessException(ResponseCode.USER_NOT_FOUND, "ç”¨æˆ·ä¸å­˜åœ¨: " + id));
        return convertToDTO(user);
    }
}

// GlobalExceptionHandler ç»Ÿä¸€å¤„ç†
@RestControllerAdvice
public class GlobalExceptionHandler extends BaseExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusinessException(BusinessException e) {
        ErrorResponse response = ErrorResponse.builder()
            .code(e.getCode())
            .message(e.getMessage())
            .detail(e.getDetail())
            .status(e.getStatus().value())
            .path(getRequestPath())
            .timestamp(Instant.now())
            .build();
        return ResponseEntity.status(e.getStatus()).body(response);
    }
}
```

### âŒ åä¾‹

```java
// é”™è¯¯ï¼šController æ‰‹åŠ¨è¿”å›é”™è¯¯ã€Service è¿”å› Map
@RestController
public class UserController {
    @GetMapping("/{id}")
    public Map<String, Object> getUser(@PathVariable Long id) {
        Map<String, Object> result = userService.getUser(id);
        if (!(Boolean) result.get("success")) {
            return Map.of("success", false, "error", result.get("error"));
        }
        return result;
    }
}
```

